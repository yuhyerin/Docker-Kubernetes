# 01.도커란?
도커는 리눅스 컨테이너에 여러 기능을 추가함으로써 애플리케이션을 컨테이너로서 좀 더 쉽게 사용할 수 있게 만들어진 오픈소스 프로젝트 입니다.
기존에 쓰이던 가상화 방법인 가상머신과는 달리 도커 컨테이너는 성능의 손실이 거의 없어서 차세대 클라우드 인프라 솔루션으로서 많은 개발자들에게 주목받고 있습니다.

도커와 관련된 프로젝트는 도커 컴포즈, 도커 허브 등 여러가지가 있지만 보통 도커엔진이라는 의미로 더 많이 쓰이는데,
도커엔진은 컨테이너를 생성하고 관리하는 주체로서 이 자체로도 컨테이너를 제어할 수 있고 다양한 기능을 제공하는 도커의 주 프로젝트이기 때문입니다.

도커의 생태계에 있는 여러 프로젝트들은 도커엔진을 좀 더 효율적으로 사용하기 위한것에 불과하기 때문에
핵심이 되는것은 도커엔진입니다.
이번 장에서는 도커컨테이너를 다루기 위한 가장 기본적인 프로젝트인 도커엔진을 사용하는 방법을 다루겠습니다.

## 1.1 가상머신과 도커 컨테이너
기존 가상화 기술은 하이퍼바이저를 이용해 여러개의 운영체제를 하나의 호스트에서 생성해 사용하는 방식이었습니다.
여러개의 운영체제는 VM이라는 단위로 구별되고, 하이퍼바이저에 의해 생성되고 관리되는 OS는 게스트 OS라고 하며 
각 게스트OS는 완전히 독립된 공간과 시스템자원을 할당받아 사용합니다. 
이러한 가상화 방식을 사용할 수 있는 대표적인 툴이 VMware, VirtualBox 등이 있습니다.

그러나 시스템자원을 가상화하고 독립된 공간을 생성하는 작업은 하이퍼바이저를 반드시 거치기 때문에 
일반 호스트에 비해 성능의 손실이 발생합니다. 또한 VM은 게스트 OS를 사용하기 위한 라이브러리, 커널 등을 전부 포함하기때문에 가상머신을 배포하기 위한 이미지로 만들었을때 이미지가 커집니다. 
가상머신 이미지를 애플리케이션으로 배포하기에는 부담스럽다는 단점이 있습니다. 

이에비해 도커 컨테이너는 가상화된 공간을 생성하기 위해 리눅스의 자체기능인 chroot, 네임스페이스, cgroup을 사용함으로써 프로세스 단위의 격리환경을 만들기 때문에 성능손실이 거의 없습니다.
컨테이너에 필요한 커널은 호스트의 커널을 공유해 사용하고, 컨테이너 안에는 어플리케이션을 구동하는데 필요한 라이브러리 및 실행파일만 존재하기 때문에 컨테이너를 이미지로 만들었을때 이미지 용량또한 가상머신에 비해 대폭 줄어듭니다.
컨테이너를 이미지로 만들어 배포하는 시간이 가상머신에 비해 빠르며, 가상화된 공간을 사용할때의 성능손실도 거의 없다는 장점이 있습니다. 

## 1.2 도커를 시작해야 하는 이유
컨테이너는 몇가지가 존재하지만 그중에서도 도커는 컨테이너 생태계에서 사실상 표준으로 사용되고 있습니다.
쿠버네티스, 메소스 같은 오픈소스 프로젝트에서도 도커를 기준으로 개발되고 있으며 이에 발맞춰 점점 더 많은 회사들이 서비스 개발 및 운영환경에 도커 컨테이너를 도입하고 있습니다. 

* 도커컨테이너와 컨테이너 자체에 대한 장점들이 당장에는 이해가 안되더라도 도커 컨테이너 구조, 원리를 이해하다보면 아래 내용이 무엇을 의미하는지 이해할 수 있다. 어느정도 내용정리가 된 후 다시 읽어보자! 

### 1.2.1 애플리케이션의 개발과 배포가 편해집니다.
서버를 부팅할때 실행되는 OS를 일반적으로 호스트OS 라고 부르며, 도커 컨테이너는 호스트OS 위에서 실행되는 격리된 공간이다.
따라서 컨테이너 자체에 특별한 권한을 주지 않는 한, 컨테이너 내부에 수많은 소프트웨어를 설치하고 설정파일을 수정해도 호스트 OS에는 영향을 끼치지 않는다. 즉, 독립된 개발환경을 보장받을 수 있다는 것이다! 

컨테이너 내부에서 여러 작업을 마친 뒤 운영환경에 배포하려 한다면, 해당 컨테이너를 '도커 이미지'라고 불리는 일종의 패키지로 만들어 운영서버에 전달하기만 하면 된다. 
컨테이너에서 사용되던 운영서버에서 새롭게 패키지를 설치할 필요도 없으며, 각종 라이브러리 설치 등으로 인한 의존성을 걱정할 필요도 없습니다. 
서비스를 개발했을때 사용했던 환경을 다른 서버에서도 컨테이너로서 똑같이 복제할 수 있기 때문에 개발/운영 환경의 통합이 가능해진다. 

게다가 도커이미지는 가상머신의 이미지와 달리 커널을 포함하고 있지 않아서 이미지 크기가 크지도 않다.
도커는 이지미 내용을 레이어 단위로 구성하며, 중복되는 레이어를 재사용할수 있어서 애플리케이션 배포속도가 매우 빠르다.

### 1.2.2 여러 애플리케이션의 독립성과 확장성이 높아집니다.
소프트웨어의 여러 모듈이 상호작용하는 로직을 하나의 프로그램 내에서 구동시키는 방식을 모놀리스 애플리케이션이라고 한다.
소규모 서비스에서는 이 방식이 어울릴지도 모르지만, 서비스 기능이 복잡해지고 거대해질수록 소프트웨어 자체의 확장성과 유연성이 줄어든다는 단점이 있다. 이러한 모놀리스 방식을 대체하기 위해 최근 새롭게 떠오른 개념이 마이크로서비스 구조다.

마이크로서비스 구조는 여러 모듈을 독립된 형태로 구성하기 때문에,
언어에 종속되지 않고, 변화에 빠르게 대응할 수 있으며, 각 모듈의 관리가 쉬워진다는 장점이 있다.
컨테이너는 수 초 내로 생성, 시작이 가능할 뿐 아니라 여러 모듈에게 독립된 환경을 동시에 제공할 수 있기 때문에 마이크로 서비스 구조에서 가장 많이 사용되고 있는 가상화 기술이다. 

예를들어 웹 서비스는 데이터메이스 컨테이너, 웹 서버 컨테이너로 분리할 수 있고 
웹 서비스에서 부하가 발생할 시 마이크로서비스 구조의 웹 서버 컨테이너만을 동적으로 늘려서 부하를 분산할 수 있다.
또한 웹서버와 데이터베이스의 이미지 버전을 독립적으로 관리하기 때문에 유지보수도 용이해진다.
이와같은 컨테이너 기반의 마이크로서비스 개발자는 그 구조를 직접 구현하기 보다는 
도커스웜모드, 쿠버네티스 등 컨테이너 오케스트레이션 플랫폼을 통해 사용하는것이 일반적이다. 

## 1.3 도커 엔진 설치
### 맥 OS에 도커 설치 
맥 OS에 설치하는 도커를 일반적으로 Docker Desktop 이라고 부르며, 맥 OS X용 Docker Desktop은 xhyve기술을 이용해 리눅스 커널기능과 도커엔진환경을 구성한다.
단, Docker Desktop에서는 도커에서 제공하는 네트워크, 볼륨 기능 일부 지원되지 않을 수 있고 예상치 못한 버그를 마주칠 가능성이 있어서 가능하면 완전한 리눅스 환경에서 도커를 사용하는 것을 권장한다.

### 1.3.3.1 Docker Desktop for Mac 
터미널에서 docker -v 로 버전 확인. 

### 1.3.4 리눅스 환경에 도커 마련하기 
AWS의 EC2를 사용해 도커를 설치할 수 있는 리눅스 환경을 마련한다. 
